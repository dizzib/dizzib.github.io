(function(){var n=function(n,t){return function(){return n.apply(t,arguments)}};define(["./helper"],function(t){var r;return new(r=function(){function r(){this.defrag=n(this.defrag,this)}r.prototype.defrag=function(n){var r,e,f,i,u,o,a,h,l,s,c,g,p,d,v;d=t.assert_matrix_dimensions(n),s=d[0],c=d[1];v=this._get_group_deltas(n,s),e=v[0],l=v[1];if(e.length===0){return n}while(true){if((r=_.max(e))===0){return n}f=e.lastIndexOf(r);h=l[f];a=n[h];if(r>1||a[0]>=0){i=a.indexOf(-(f+1));n[h]=_.rest(a,i).concat(_.first(a,i))}for(o=g=0,p=l.length;g<p;o=++g){u=l[o];if(Math.abs(h-u)<=1){e[o]=0}}}};r.prototype._get_group_deltas=function(n,t){var r,e,f,i,u,o,a,h,l,s,c,g,p,_,d,v,x,m,b,y,M,O,w,I,j,k;_=function(){var t,e,f;f=[];for(t=0,e=n.length;t<e;t++){d=n[t];f.push(function(){var n,t,e;e=[];for(n=0,t=d.length;n<t;n++){r=d[n];e.push(Math.abs(r))}return e}())}return f}();j=n[0];for(x=0,M=j.length;x<M;x++){r=j[x];u=0}i=[];v=[];_=[u].concat(_.concat([u]));for(l=m=0,O=n.length;m<O;l=++m){d=n[l];s=l+1;for(p=b=0,w=d.length;b<w;p=++b){a=d[p];if(!(a<0&&p>0)){continue}k=[0,Math.abs(a)-1,d.indexOf(a)],f=k[0],o=k[1],h=k[2];for(c=y=0,I=d.length;y<I;c=++y){r=d[c];if(_[s-1][c]-_[s][c]===0){f--}if(_[s+1][c]-_[s][c]===0){f--}g=(h+c)%(t+1);if(_[s-1][c]-_[s][g]===0){f++}if(_[s+1][c]-_[s][g]===0){f++}}i[o]=f+1;v[o]=l}}return[function(){var n,t,r;r=[];for(t=0,n=i.length;t<n;t++){e=i[t];r.push(e!=null?e:0)}return r}(),function(){var n,t,r;r=[];for(t=0,n=v.length;t<n;t++){l=v[t];r.push(l!=null?l:0)}return r}()]};return r}())})}).call(this);