(function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};define(["underscore","lib/guardian"],function(e,n){var i;return new(i=function(){function i(){this._defrag_last_group=t(this._defrag_last_group,this);this._append_cells_to_lane=t(this._append_cells_to_lane,this);this._populate_lanes=t(this._populate_lanes,this);this.build=t(this.build,this)}i.prototype.build=function(t,e,i){var r,a,l;n.assert(function(){return e.length===i.length});this._populate_lanes(t,e,i);for(a=0,l=t.length;a<l;a++){r=t[a];this._quantize_lane(r)}return t};i.prototype._populate_lanes=function(t,n,i){var r,a,l,s,u;for(r=s=0,u=i.length;s<u;r=++s){l=i[r];a=e.min(t,function(t){return 100*t.matrix.length+e.last(t.matrix).length});this._append_cells_to_lane(a,n[r],l)}return t};i.prototype._append_cells_to_lane=function(t,n,i){var r,a,l,s,u,_,o,p;if((a=e.last(t.matrix)).length===t.x_size){t.matrix.push(a=[])}o=[a.length,(a.length+i-1)%t.x_size],s=o[0],l=o[1];u=Math.floor((s+i)/t.x_size);if(u>0&&s>l){this._defrag_last_group(t,n-1);t.matrix.push(a=[])}p=[];for(r=_=1;1<=i?_<=i:_>=i;r=1<=i?++_:--_){if(a.length===t.x_size){t.matrix.push(a=[])}p.push(a.push(r===1?-n:n))}return p};i.prototype._defrag_last_group=function(t,n){var i,r,a,l,s,u,_,o,p,h,f;if(n===0){return}f=[(i=l=e.last(t.matrix)).length,t.matrix.length-1],s=f[0],o=f[1];while(o>0&&(_=l.indexOf(-n))<0){l=t.matrix[--o]}if(_!=null&&_>=s){a=t.x_size-_;u=s+a-1;for(r=p=1;1<=a?p<=a:p>=a;r=1<=a?++p:--p){[].splice.apply(l,[_,t.x_size-1-_+1].concat(0)),0}for(r=h=1;1<=a?h<=a:h>=a;r=1<=a?++h:--h){[].splice.apply(i,[s,u-s+1].concat(n)),n}i[0]=-n}return this._quantize_lane(t)};i.prototype._quantize_lane=function(t){var n,i;n=e.last(t.matrix);i=[];while(n.length<t.x_size){i.push(n.push(0))}return i};return i}())})}).call(this);