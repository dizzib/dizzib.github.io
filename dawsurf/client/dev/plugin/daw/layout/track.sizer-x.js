(function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};define(["jquery","underscore","lib/guardian","lib/platform/window","plugin/constants","plugin/element/devices","plugin/element/gutters","plugin/element/track","plugin/element/tracks"],function(e,i,s,r,_,n,o,a,h){var p;return new(p=function(){function i(){this._get_volumes=t(this._get_volumes,this);this._refresh_display_aspect=t(this._refresh_display_aspect,this);this.resize=t(this.resize,this)}i.prototype._CELL_SIZE_CORRECTION=2;i.prototype._DISPLAY_ASPECT_CORRECTION=.8;i.prototype._TRACK_WIDTH_CORRECTION=8;i.prototype._x_sizes=[];i.prototype.on_resize=function(){};i.prototype.on_track_resize=function(){};i.prototype.resize=function(t){var e,i,p,u,l,c,d,f,g,C,w,y,E,R,m,I=this;if(!(t!=null)){t={window:r}}this._refresh_display_aspect(t);E=this._get_volumes(),c=E[0],p=E[1];C=Math.sqrt(p)*s.assert(function(){return I._display_aspect});for(w=0,y=c.length;w<y;w++){R=c[w],e=R[0],l=R[1];d=Math.max(2,Math.floor(C*l/Math.max(1,p)));n.set_width(e,d*_.CELL_SIZE+this._CELL_SIZE_CORRECTION);m=[this._x_sizes[u=e.attr("id")],d],g=m[0],f=m[1];this._x_sizes[u]=f;i=e.is(t.$track)||a.is_parent(e,t.$target);if(f!==g||i){this.on_track_resize({$track:e,x_size:f})}}t.width_tracks=h.get_width()+o.get_width()+this._TRACK_WIDTH_CORRECTION;h.set_width_root(t.width_tracks);return this.on_resize(t)};i.prototype._refresh_display_aspect=function(t){if(t.window){return this._display_aspect=this._DISPLAY_ASPECT_CORRECTION*t.window.width/t.window.height}};i.prototype._get_volumes=function(){var t,i,s,r,_,o,a,p,u;p=[[],0],_=p[0],i=p[1];u=h.get_expanded();for(o=0,a=u.length;o<a;o++){s=u[o];_.push([t=e(s),r=n.get_volume(t)]);i+=r}return[_,i]};return i}())})}).call(this);