(function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};define(["jquery","lib/guardian","plugin/constants","plugin/element/tracks","plugin/lib/ui/scrollport","plugin/model/setting/is-super-scroll","css!./gutter"],function(e,r,i,n,s,a){var o;return new(o=function(){function i(){this._remove_track=t(this._remove_track,this);this._move_track=t(this._move_track,this);this._expand_track=t(this._expand_track,this);this._collapse_track=t(this._collapse_track,this);this._add_track=t(this._add_track,this);this.remove=t(this.remove,this);this.move=t(this.move,this);this.insert=t(this.insert,this);this.collapse=t(this.collapse,this);this.add=t(this.add,this);this.init=t(this.init,this)}i.prototype.init=function(t){return t.$desk.on("safe-tap",".gutter-i > .track > .head",{expand:this._expand_track},function(t){var r;r=e(this).parent();if(!r.hasClass("disabled")){t.data.expand({$track:r})}return false})};i.prototype.on_add_first=function(){};i.prototype.on_expand=function(){};i.prototype.add=function(t){return this._add_track(t)};i.prototype.collapse=function(t){return this._collapse_track(t)};i.prototype.insert=function(t){return this._collapse_track(t)};i.prototype.move=function(t){return this._move_track(t)};i.prototype.remove=function(t){return this._remove_track(t)};i.prototype.set_height=function(t,e){t.find("> .gutter-i").andSelf().height(e);if(a.value()){return s.refresh(t)}};i.prototype._add_track=function(t){this._collapse_track(t);if(e(".gutter-o").length===1){return this.on_add_first()}};i.prototype._create_gutter=function(){var t;t=e(e.zen(".gutter-o>.gutter-i"));if(a.value()){s.init(t.find(".gutter-i"),{x:false})}return t};i.prototype._collapse_track=function(t){var e,r,i,s;if(!this._is_in_gutter(t.$track)){s=[t.$track.prevAll(".gutter-o").first(),t.$track.nextAll(".gutter-o").first()],r=s[0],e=s[1];if(r.length===0){n.prepend(r=this._create_gutter())}i=t.$track.prev().hasClass("gutter-o")?r:e;if(i.length===0){i=e=this._create_gutter().insertAfter(t.$track)}i.find(".gutter-i").append(t.$track);this._merge_adjacent_gutters()}return t.$track.removeAttr("style")};i.prototype._expand_track=function(t){var e,i,n,s=this;r.assert(function(){return s._is_in_gutter(t.$track)});e=t.$track.parent().parent();if(t.$track.is(".track:first")){t.$track.insertBefore(e);if(!this._is_in_gutter(t.$track.prev())){this._create_gutter().insertBefore(t.$track)}}else{n=t.$track.nextAll(".track");t.$track.insertAfter(e);if(n.length>0||!this._is_in_gutter(t.$track.next())){if((i=t.$track.next(".gutter-o")).length===0){i=this._create_gutter().insertAfter(t.$track)}i.find(".gutter-i").prepend(n)}}this.on_expand(t);return this._trim_side_gutters()};i.prototype._is_in_gutter=function(t){return t.parent().hasClass("gutter-i")};i.prototype._move_track=function(t){var e,i,n,s;s=t.target_placement==="Before";if(this._is_in_gutter(t.$track)){if(this._is_in_gutter(t.$target)){if(s){t.$track.insertBefore(t.$target)}else{t.$track.insertAfter(t.$target)}}else{if((i=s?t.$target.prev(".gutter-o"):t.$target.next(".gutter-o")).length===0){r.assert(function(){return!s});i=this._create_gutter().insertAfter(t.$target)}n=i.find(".gutter-i");if(s){t.$track.appendTo(n)}else{t.$track.prependTo(n)}}return this._trim_side_gutters()}else{t.$track.detach();this._merge_adjacent_gutters();if(this._is_in_gutter(t.$target)){if(s){t.$target.before(t.$track)}else{t.$target.after(t.$track)}return this._expand_track(t)}else{e=this._create_gutter();if(s){return t.$target.before(t.$track,e)}else{return t.$target.after(e,t.$track)}}}};i.prototype._remove_track=function(t){this._merge_adjacent_gutters();return this._trim_side_gutters()};i.prototype._trim_side_gutters=function(){var t,e,r,i,s,a;s=[n.get_first,n.get_last];a=[];for(r=0,i=s.length;r<i;r++){t=s[r];if((e=t()).hasClass("gutter-o")&&e.find(".gutter-i").children().length===0){a.push(e.remove())}else{a.push(void 0)}}return a};i.prototype._merge_adjacent_gutters=function(){var t,r,i,n,s,a;s=e(".gutter-o + .gutter-o");a=[];for(i=0,n=s.length;i<n;i++){t=s[i];r=e(t).prev();e(t).find(".gutter-i").prepend(r.find(".gutter-i").children());a.push(r.remove())}return a};return i}())})}).call(this);