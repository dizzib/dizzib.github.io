(function(){var t=function(t,i){return function(){return t.apply(i,arguments)}};define(["jquery","underscore","plugin/lib/ui/viewport","input/touch","css!./param.slider.css"],function(i,e,_,s){var n;return new(n=function(){function n(){this._enable_rail=t(this._enable_rail,this);this._get_initial_pos=t(this._get_initial_pos,this);this._on_touchmove=t(this._on_touchmove,this);this._initialise_pos=t(this._initialise_pos,this);this.stop_input=t(this.stop_input,this);this.start_input=t(this.start_input,this)}n.prototype._THROTTLE_FREQ_HZ=20;n.prototype.on_input_start=function(){};n.prototype.on_input_stop=function(){};n.prototype.on_value_change=function(){};n.prototype.start_input=function(t,e){var _,n=this;if(this._$p){this.stop_input()}this._$p=t;this._$rail=t.data("sensor");this._$puck=i(i.zen(".puck")).appendTo(this._$rail);this.on_input_start(t);this._$rail.addClass("rail").appendTo(this._div_root);this._$p.attr("value_user",_=this._$p.attr("value"));this._initialise_pos(_,e.pageX);if(e.is_tap){return this._$rail.on(s.event_name_start,function(t){n._on_touchmove(t);return n._enable_rail()})}else{return this._enable_rail()}};n.prototype.stop_input=function(){if(!this._$p){return}this._$rail.off(""+s.event_name_start+" "+s.event_name_move+" "+s.event_name_end);this._$rail.removeAttr("style").removeClass("rail");this._$puck.remove();this.on_input_stop(this._$p,this._$rail);delete this._$rail;delete this._$puck;return delete this._$p};n.prototype._initialise_pos=function(t,i){var e,s,n;this._rail_width=this._$rail.width();this._puck_width_semi=this._$puck.width()/2;n=this._get_initial_pos(t,i),e=n[0],this._rail_left=n[1];s=this._$rail.height()+2*parseInt(this._$rail.css("border-top-width"),10);this._$puck.css("left",e);return this._$rail.css("left",this._rail_left).css("top",_.get_css_bottom(this._$p)-s)};n.prototype._on_touchmove=function(t){var i,e,_,n;if(this._$rail===void 0){return}t.preventDefault();e=s.get_raw_event(t);i=Math.min(this._rail_width,Math.max(0,e.pageX-this._rail_left));this._$puck.css("left",i-this._puck_width_semi);n=parseInt(this._$p.attr("value_user"));_=Math.floor(100*i/this._rail_width);if(_!==n){this._$p.attr("value_user",_);return this.on_value_change({uid:this._$p.attr("id"),value:_})}};n.prototype._get_initial_pos=function(t,i){var e,s,n;s=this._rail_width*t/100;e=s-this._puck_width_semi;if(i!=null){n=i-s}else{n=_.get_css_left(this._$p)-s}return[e,n]};n.prototype._enable_rail=function(){var t=this;this._$rail.on(s.event_name_move,e.throttle(function(i){return t._on_touchmove(i)},1e3/this._THROTTLE_FREQ_HZ,false,function(t){return t.preventDefault()}));this._$rail.on(s.event_name_end,function(i){return t.stop_input()});return this._$puck.on(s.event_name_end,function(i){return t.stop_input()})};return n}())})}).call(this);