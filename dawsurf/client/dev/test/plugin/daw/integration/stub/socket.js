(function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=[].slice;define(["underscore","sys/messaging/protocol"],function(s,r){var i;return new(i=function(){function i(){this._get_args_trk=t(this._get_args_trk,this);this._get_args_grp=t(this._get_args_grp,this);this._get_args_dev=t(this._get_args_dev,this);this.send=t(this.send,this);this.connect=t(this.connect,this);this.close=t(this.close,this);this.add_groups=t(this.add_groups,this);this.remove_device=t(this.remove_device,this);this.insert_track=t(this.insert_track,this);this.insert_device=t(this.insert_device,this);this.add_track=t(this.add_track,this);this.add_device=t(this.add_device,this)}i.prototype._READY_STATES={CONNECTING:0,OPEN:1,CLOSING:2,CLOSED:3};i.prototype.readyState=void 0;i.prototype.onmessage=function(){};i.prototype.add_device=function(t,e){return this.onmessage(this._pack("FA",this._get_args_dev(t,e)))};i.prototype.add_track=function(t){return this.onmessage(this._pack("FA",this._get_args_trk(t)))};i.prototype.insert_device=function(t,e){return this.onmessage(this._pack("FI",this._get_args_dev(t,e)))};i.prototype.insert_track=function(t,e){return this.onmessage(this._pack("FI",this._get_args_trk(t,e)))};i.prototype.remove_device=function(t){return this.onmessage(this._pack("FX",this._get_args_dev(t)))};i.prototype.add_groups=function(t,e){var s,r,i,n,a,_,o,g,h;h=[t*10,0,0],s=h[0],a=h[1],i=h[2];for(_=0,g=e.length;_<g;_++){n=e[_];if(n===a){i++}else{i=1}this.onmessage(this._pack("FA",this._get_args_grp(s,t,""+t+" "+String.fromCharCode(n+"@".charCodeAt())+" "+i)));for(r=o=1;1<=n?o<=n:o>=n;r=1<=n?++o:--o){this.onmessage(this._pack("PA",this._get_args_par(r+s*100,s,r)))}a=n;s++}return this.onmessage(this._pack("FR",this._get_args_dev(t)))};i.prototype.close=function(){this.readyState=this._READY_STATES.CLOSED;return this.onclose()};i.prototype.connect=function(){this.readyState=this._READY_STATES.OPEN;this.onopen();return r.on_handshake_pass()};i.prototype.send=function(t){var e,r,i,n;n=t.split(/\s(.+)/),r=n[0],i=n[1];if(r==="PU"){e=JSON.parse(i);return this.onmessage(this._pack("PV",s.extend(e,{value_text:""+e.value+"%"})))}};i.prototype._get_args=function(t,e,s,r){var i;if(r==null){r=""+t}i={uid:t,name:""+e+" "+r};if(e!=null){i.category=e}if(s!=null){i.target_uid=s}return i};i.prototype._get_args_dev=function(){var t,s;s=arguments[0],t=2<=arguments.length?e.call(arguments,1):[];return this._get_args.apply(this,[s,"device"].concat(e.call(t)))};i.prototype._get_args_grp=function(){var t,s;s=arguments[0],t=2<=arguments.length?e.call(arguments,1):[];return this._get_args.apply(this,[s,"group"].concat(e.call(t)))};i.prototype._get_args_par=function(t,e,s){return{uid:t,target_uid:e,name:"param "+s,value:50,value_text:"50%"}};i.prototype._get_args_trk=function(){var t,s;s=arguments[0],t=2<=arguments.length?e.call(arguments,1):[];return this._get_args.apply(this,[s,"track"].concat(e.call(t)))};i.prototype._pack=function(t,e){return{data:(""+t+" "+JSON.stringify(e)).trim_lr()}};return i}())})}).call(this);