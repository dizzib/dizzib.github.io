(function(r){r(["./when"],function(r){var e,n,t,o,i;e=0;n={};o=Object.prototype.hasOwnProperty;t={RangeError:1,ReferenceError:1,SyntaxError:1,TypeError:1};function u(e,n,t,o){var i=[e].concat(p(e,[n,t,o]));return f(r.apply(null,i),e)}function f(r,n){var t,i,u,c;if(o.call(r,"parent")){return r}e++;t=n&&"id"in n?n.id+"."+e:e;i=r.then;u=m(r);u.id=t;u.parent=n;u.toString=function(){return g("Promise",t)};u.then=function(e,n){if(typeof n==="function"){var t=u;do{t.handled=true}while((t=t.parent)&&!t.handled)}return f(i.apply(r,p(u,arguments)),u)};c=function(){console.error(u.toString())};r.then(function(r){u.toString=function(){return g("Promise",t,"resolved",r)};return r},a(u,function(r){u.toString=function(){return g("Promise",t,"REJECTED",r)};h("reject",u,r);if(!u.handled){c()}throw r}));return u}function c(){var t,o,u,c,s,l,a,p;t=r.defer();o="pending";u=n;p=arguments[arguments.length-1];if(p===i){p=++e}a=t.promise.then;t.id=p;t.promise=f(t.promise,t);t.resolver=m(t.resolver);t.resolver.toString=function(){return g("Resolver",p,o,u)};l=t.resolver.progress;t.progress=t.resolver.progress=function(r){h("progress",t,r);return l(r)};c=t.resolver.resolve;t.resolve=t.resolver.resolve=function(r){u=r;o="resolving";h("resolve",t,r);return c.apply(i,arguments)};s=t.resolver.reject;t.reject=t.resolver.reject=function(r){u=r;o="REJECTING";return s.apply(i,arguments)};t.toString=function(){return g("Deferred",p,o,u)};t.then(function(r){o="resolved";return r},function(e){o="REJECTED";return r.reject(e)});t.then=t.promise.then;t.resolver.id=p;return t}u.defer=c;u.isPromise=r.isPromise;for(var s in r){if(r.hasOwnProperty(s)&&!(s in u)){l(s,r[s])}}return u;function l(e,n){u[e]=function(){return f(n.apply(r,arguments))}}function a(r,e){return function(n){try{return e(n)}catch(o){if(o){if(o.name in t){d(o)}h("reject",r,o)}throw o}}}function p(r,e){var n,t,o,i;t=[];for(i=0,o=e.length;i<o;i++){t[i]=typeof(n=e[i])=="function"?a(r,n):n}return t}function h(r,e,n,t){var o=u.debug;if(!(o&&typeof o[r]==="function")){return}if(arguments.length<4&&r=="reject"){try{throw new Error(e.toString())}catch(i){t=i}}try{o[r](e,n,t)}catch(f){d(new Error("when.js global debug handler threw: "+String(f)))}}function g(r,e,t,o){var i="[object "+r+" "+e+"]";if(arguments.length>2){i+=" "+t;if(o!==n){i+=": "+o}}return i}function d(r){setTimeout(function(){throw r},0)}function v(){}function m(r){v.prototype=r;r=new v;v.prototype=i;return r}})})(typeof define=="function"?define:function(r,e){typeof module!="undefined"?module.exports=e(require("./when")):this.when=e(this.when)});