define(["wire/domReady","when","../dom/base"],function(e,n,t){function r(e,t,r){n(r(t.element),function(e){if(!e||!e.nodeType||!e.tagName){throw new Error("dom: non-element reference provided to element factory")}return e}).then(e.resolve,e.reject)}return function i(i){var o,f,u,a,c,s,l,d,y,m;o=i.byId||t.byId;f=i.query||t.querySelectorAll;u=i.first||t.querySelector;a=i.init;c=i.addClass;l=i.placeAt||t.placeAt;s=i.removeClass;function v(e,n){var t;if(!n){return e.resolve(o)}t=o(n);if(t){e.resolve(t)}else{e.reject(new Error("No DOM node with id: "+n))}}d=function(n,t){e(function(){d=v;v(n,t)})};function h(e,n,t,r){var i,o;i=r(e,t);if(typeof n.i!="undefined"){o=n.i;if(i[o]){return i[o]}else{throw new Error("Query '"+e+"' did not find an item at position "+o)}}else if(r==u&&!i){throw new Error("Query '"+e+"' did not find anything")}else{return i}}function w(e,t,r){var i,o,f,u;f=t.options;o=t.target;for(var a in f){if(f.hasOwnProperty(a)){u=a;break}}i=r(b(f[u]));n(i,function(e){return l(o,e,u)}).then(e.resolve,e.reject)}y=function(n,t,r){e(function(){y=w;w(n,t,r)})};function p(e,t,r,i,o){var u;if(!o){o=f}if(!t){return e.resolve(o)}if(r.at&&!r.isRoot){u=i(E(r.at))}n(u,function(e){return h(t,r,e,o)}).then(e.resolve,e.reject)}m=function(n,t,r,i,o){e(function(){m=p;p(n,t,r,i,o)})};function g(e,n,t,r){m(e,n,t,r,u)}function E(e){var n=b(e);if(n){n.isRoot=true}return n}function b(e){return typeof e=="string"?{$ref:e}:e}function j(e,n){return function(t,r,i,o){if(!i.at){i.at=n.at}else{i.at=E(i.at)}return e(t,r,i,o)}}function q(e,n,t){if(n){c(e,n)}if(t){s(e,t)}}return{wire$plugin:function(n,i,o){var u,c,s,l;o.at=E(o.at);if(a){a(n,i,o)}u=o.classes;if(u){e(function(){var e=document.getElementsByTagName("html")[0];q(e,u.init);n.then(function(){q(e,u.ready,u.init)});if(u.ready){i.then(function(){q(e,null,u.ready)})}})}c={dom:d};s={insert:{initialize:y}};l={element:r};if(f){c["dom.first"]=j(g,o);c["dom.all"]=c["dom.query"]=j(m,o)}return{resolvers:c,facets:s,factories:l,proxies:[function(e){return t.nodeProxy(e)}]}}}}});