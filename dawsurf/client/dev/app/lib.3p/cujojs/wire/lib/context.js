(function(n){n(["require","when","when/timeout","./array","./object","./moduleLoader","./lifecycle","./resolver","../base"],function(n,r,e,t,i,o,u,f,c){"use strict";var s,a,l,p,v;s=r.defer;a=r.chain;l=r.all;p={};function d(){}function h(n,e,t){function i(n){return y(n,e,t)}var o=w(e,t);return r(n,function(n){return Array.isArray(n)?r(m(n,o),i):r(O(n)?o(n):n,i)})}return h;function y(n,e,o){var p,m,q,L,R,E,k,C,D,M,T,z,B,F,G,H,I,J,K,N,Q,S,U,V;M=[];if(!e){e={}}if(!o){o={}}Y(e,o);_();vr(c);nr(o);T.resolver=D;V=function(){V=function(){};return r(ir(),X)};q={spec:n,components:k,config:L};function W(){return A(R.init,q)}function X(){return A(R.destroy,q)}return W().then(function(){var r=rr(n,S);er(r,n);tr();return S.promise});function Y(n,e){d.prototype=Z(i.inherit(n.components));k=new d;d.prototype=v;z=i.inherit(n.resolvers);B=i.inherit(n.factories);F=i.inherit(n.facets);z.wire=Lr;B.wire=Rr;G=t.delegate(n.listeners);H=t.delegate(n.proxiers);E=[];K=[];J=[];Q=s();S=s();U=s();I=w(n,e);m={moduleLoader:I,components:k,destroyed:U};p=Object.create(m);p.resolvers=z;p.factories=B;p.facets=F;p.listeners=G;p.proxiers=H;p.resolveRef=qr;p.destroy=Pr;p.path=cr(e.name,n.path);if(n.destroyed){r(n.destroyed,Pr)}}function Z(n){N=n.wire=fr;N.destroy=n.destroy=ur;N.resolve=n.resolve=or;return n}function _(){T=function(n,r,e){return lr(n,cr(r,e))};T.resolveRef=or;T.getProxy=jr;T.loadModule=pr}function nr(n){L={pluginApi:T,resolvers:z,facets:F,listeners:G};C=new u(L);D=new f(L);R={init:t.delegate(n.init),destroy:t.delegate(n.destroy)}}function rr(n,r){var e,t;e=[];t={};for(var i in n){if(!k.hasOwnProperty(i)){e.push(t[i]=k[i]=s())}}a(l(e),r,k);return t}function er(n,r){for(var e in n){sr(e,r[e],k[e])}}function tr(){l(J,function(n){Q.resolve(n);J=v},Q.reject)}function ir(){var n;U.resolve();n=r.reduce(E,function(n,r){return C.shutdown(r)},v);return r(n,function(){var n,t;function i(n){for(var r in n){delete n[r]}}i(k);i(p);return r.reduce(E,function(n,e){r(n,function(){e.destroy()})},v).then(function(){k=p=e=z=B=F=G=N=E=H=K=v;return U})})}function or(n,e){return r(qr(n,{},e))}function ur(){return Pr()}function fr(n,r){return h(n,m,r)}function cr(n,r){var e=r||p.path;return e&&n?e+"."+n:n}function sr(n,e,t){var i=lr(e,n);return r(i,function(r){ar(n,r);t.resolve(r)},j(t))}function ar(n,r){k[n]=b(r)}function lr(n,e){var t;if(D.isRef(n)){t=$r(n,e)}else if(Array.isArray(n)){t=wr(n,e)}else if(i.isObject(n)){t=mr(n,e)}else{t=r.resolve(n)}return t}function pr(n,e){var t=s();i(O(n)?I(n):n,t);return t.promise;function i(n,t){var i=r(n,function(n){return r(vr(n,e),function(){a(Q,t,n)})},t.reject);J&&J.push(i)}}function vr(n,e){if(n&&x(n.wire$plugin)&&K.indexOf(n.wire$plugin)===-1){K.push(n.wire$plugin);return r(n.wire$plugin(S.promise,U.promise,e),function(r){r&&dr(r);return n})}return n}function dr(n){yr(n.resolvers,z);yr(n.factories,B);yr(n.facets,F);G.push(n);hr(n.proxies)}function hr(n){if(!n){return}var r,e,t=0;r=[];while(e=n[t++]){if(H.indexOf(e)<0){r.push(e)}}p.proxiers=H=r.concat(H)}function yr(n,r){var e;for(e in n){if(r.hasOwnProperty(e)){throw new Error("Two plugins for same type in scope: "+e)}r[e]=n[e]}}function wr(n,e){return n.length?r.map(n,function(n){return lr(n,e+"[]")}):[]}function mr(n,e){return r(Or(n),function(r){var t=s();if(!n.id){n.id=e}r(t.resolver,n,T);return gr(t,n,e)},function(){return y(n,p,{name:e}).then(function(n){return g({},n)})})}function gr(n,e,t){return r(n,function(n){return r(xr(n,e),function(n){return C.init(n)}).then(function(n){ar(t,n.target);return C.startup(n)}).then(function(n){return n.target})})}function Or(n){function e(){var r,e;for(r in B){if(n.hasOwnProperty(r)){e=B[r];break}}return e}return e()||r(Q,function(){return e()||r.reject(n)})}function xr(n,e){return r(Q,function(){var r,t,i,o;o=0;while((r=H[o++])&&!(t=r(n,e))){}t.target=n;t.spec=e;if(e){i=e&&e.id;t.id=i;t.path=cr(i);E.push(t)}return t})}function jr(n,e){return typeof n!="string"?xr(n):r(qr(n,{},e),function(n){return xr(n)})}function Pr(){return r(S,V,V)}function br(n,e,t){var i=n.resolver?r(Q,n.resolve):Ar(n.name,e);return $(i,M,n.name,t)}function Ar(n,e){var t=n.split(".");if(t.length>2){return r.reject('Only 1 "." is allowed in refs: '+n)}return r.reduce(t,function(e,t){return t in e?e[t]:r.reject("Cannot resolve ref: "+n)},e)}function $r(n,r){var t;n=D.parse(n);t=r==n.name&&e.components?e.components:k;return br(n,t,r)}function qr(n,r,e){return br(D.create(n,r),k,e)}function Lr(n){n.resolve(N)}function Rr(n,e,t){var i,o,u,f,c;i=e.wire;if(O(i)){o=i}else{o=i.spec;c=i.waitParent;f=i.defer;u=i.provide}function s(n){if(u){return r(t(u),function(r){g(n.components,r)})}}function a(n){var e,t;e=n?[].concat(o,n):o;t={init:s};var i=fr(e,t);return f?i:r(i,function(n){return n.hasOwnProperty("$exports")?n.$exports:n})}if(f){n.resolve(a)}else if(c){var l=r(S,function(){return a()});n.resolve(new P(l))}else{r.chain(a(e),n)}}}function w(n,r){return r&&r.require?o(r.require):n.moduleLoader}function m(n,e){return r.reduce(n,function(n,t){return O(t)?r(e(t),function(r){return g(n,r)}):g(n,t)},{})}function g(n,r){for(var e in r){if(r.hasOwnProperty(e)&&!(e in p)){if(n.hasOwnProperty(e)){throw new Error("Duplicate component name in sibling specs: "+e)}else{n[e]=r[e]}}}return n}function O(n){return typeof n=="string"}function x(n){return typeof n=="function"}function j(n){return function(r){n.reject(r)}}function P(n){this.value=n}function b(n){return n instanceof P?n.value:n}function A(n){var e=t.fromArguments(arguments,1);return r.reduce(n,function(n,t){return r(t.apply(n,e),function(){return n})},v)}function $(n,r,e,t){return n}})})(typeof define=="function"?define:function(n,r){module.exports=r.apply(this,[require].concat(n.slice(1).map(function(n){return require(n)})))});