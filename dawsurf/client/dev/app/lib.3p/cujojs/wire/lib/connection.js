(function(n){n(["when","./array","./functional"],function(n,r,e){"use strict";return{parse:t,parseIncoming:u,parseOutgoing:o};function t(r,e,t,i,f){var c,s;c=e.split(".");s=c[1];c=c[0];return n(i.resolveRef(c),function(n){return u(n,s,r,e,t,i,f)},function(){return o(r,e,t,i,f)})}function u(r,t,u,o,i,c,s){var a,p;if(t){p=i;a=n(e.compose.parse(u,p,c),function(n){return s(r,t,f(u,n))})}else{r=p;a=n(c.resolveRef(o),function(r){var t,o;function a(n,r,e){return function(t){return s(n,r,f(e,t))}}o=[];for(t in i){o.push(n(e.compose.parse(u,i[t],c),a(r,t,u)))}return n.all(o)})}return a}function o(n,r,e,t,u){return i(n.target,r,n,r,e,t,u)}function i(r,t,u,o,i,c,s){var a,p,l,g;function m(u,o){return n(e.compose.parse(u,o,c),function(n){return s(r,t,f(u,n))})}if(typeof i=="string"){a=m(u,i)}else{p=[];l=function(r,e){return n(c.getProxy(r),function(n){return m(n,e)})};for(g in i){p.push(l(g,i[g]))}a=n.all(p)}return a}function f(n,r){return function(){return n.invoke(r,arguments)}}})})(typeof define=="function"?define:function(n,r){module.exports=r.apply(this,n.map(function(n){return require(n)}))});