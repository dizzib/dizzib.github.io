(function(n){n(["meld","when","./lib/connection"],function(n,t,r){var e,u,i;e=["before","around","afterReturning","afterThrowing"];u="connect:before";function f(n,t,r){r=r?[n].concat(r):[n];t.apply(null,r)}function o(n,r,e,u){function i(r){return e?t(u(e),function(t){f(n,r,t)}):f(n,r)}return t(u.resolveRef(r),i)}function c(n,r,e){var u,i,f;u=r.target;i=r.options;f=[];for(var c in i){f.push(o(u,c,i[c],e))}t.chain(t.all(f),n)}function a(n,t,e,u,i,f){function o(r,e,u){t.push(n(r,e,u))}return r.parse(e,u,i,f,o)}function l(t){return function(r,e,u){return n[t](r,e,u)}}function s(r,e,u){return n.afterReturning(r,e,function(n){return t(n,u)})}function p(r,e,u){return n.afterReturning(r,e,function(n){return t(n,null,u)})}function v(r,e,u){return n.after(r,e,function(n){return t(n,u,u)})}function g(n,r){return function(e,u,i){var f,o,c,l;o=u;c=u.options;l=[];for(f in c){l.push(a(n,r,o,f,c[f],i))}t.chain(t.all(l),e)}}function h(n,r,e,u){return t(e.resolveRef(r),function(t){var r=t.pointcut;if(r){u(n,r,t)}return n})}function d(n,r,e,u){var i,f;i=r.pointcut;f=r.advice;function o(r){return t(e.resolveRef(f),function(t){u(n,r,t);return n})}return typeof i==="string"?t(e.resolveRef(i,o)):o(i)}function R(n,r,e,u,f){var o,c,a,l;a=u.aspects;c=r.path;if(!a||c===i){n.resolve();return}o=r.target;l=h;t.chain(t.reduce(a,function(n,t){var r;if(t.advice){r=t.advice;l=d}else{r=t}return typeof r==="string"&&r!==c?l(n,t,e,f):n},o),n)}return{wire$plugin:function(r,i,f){var o,a,h,d,y;o=[];t(i,function(){for(var n=o.length-1;n>=0;--n){o[n].remove()}});function m(t,r,e){o.push(n.add(t,r,e))}function b(n,t){var r={};r[n]=function(n,r,e){t(n,r,e)};return r}a={facets:{decorate:b("configure:after",c),afterFulfilling:b(u,g(s,o)),afterRejecting:b(u,g(p,o)),after:b(u,g(v,o))}};if(f.aspects){a.create=function(n,t,r){R(n,t,r,f,m)}}for(h=0,d=e.length;h<d;h++){y=e[h];a.facets[y]=b(u,g(l(y),o))}return a}}})})(typeof define=="function"?define:function(n,t){module.exports=t.apply(this,n.map(require))});