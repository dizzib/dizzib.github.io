(function(){var t=function(t,s){return function(){return t.apply(s,arguments)}};define(["lib/guardian","lib/sys/net","sys/messaging/protocol"],function(s,r,o){var n;return new(n=function(){function n(){this.update_param=t(this.update_param,this);this.unload=t(this.unload,this);this.stop=t(this.stop,this);this.start=t(this.start,this);this.process=t(this.process,this);this.load=t(this.load,this);this.init=t(this.init,this);this.error=t(this.error,this);this.bang=t(this.bang,this);this.abort=t(this.abort,this)}n.prototype._states={IDLE:0,STARTED:1,LOADED:2};n.prototype._state=0;n.prototype.on_error=function(){};n.prototype.on_init=function(){};n.prototype.on_load=function(){};n.prototype.on_start=function(){};n.prototype.on_stop=function(){};n.prototype.on_unload=function(){};n.prototype.abort=function(t){this.stop();this.on_error(t);return this._state=this._states.IDLE};n.prototype.bang=function(){return r.trigger([o.TRIGGERS.BANG])};n.prototype.error=function(t){return this.on_error(t)};n.prototype.init=function(){var t=this;s.assert(function(){return t._state===t._states.STARTED});return r.trigger([o.TRIGGERS.PROTOCOL_PROBE])};n.prototype.load=function(){var t=this;s.assert(function(){return t._state===t._states.STARTED});this.bang();this.on_load();return this._state=this._states.LOADED};n.prototype.process=function(t){var r,n;n=t[0],r=t[1];s.assert(function(){return n in o.COMMANDS});return o.COMMANDS[n](r)};n.prototype.start=function(t){var r=this;s.assert(function(){return r._state===r._states.IDLE||r._state===r._states.STARTED});this.on_start(t);return this._state=this._states.STARTED};n.prototype.stop=function(){return this.on_stop()};n.prototype.unload=function(t){if(this._state!==this._states.LOADED){return}this.on_unload(t);return this._state=this._states.IDLE};n.prototype.update_param=function(t){return r.trigger([o.TRIGGERS.PARAM_UPDATE,t])};return n}())})}).call(this);