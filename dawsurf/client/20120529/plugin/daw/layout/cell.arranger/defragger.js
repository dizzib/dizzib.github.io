(function(){var a=function(a,b){return function(){return a.apply(b,arguments)}};define(["./helper","lib/guardian"],function(b){var c;return c=function(){function c(){this.defrag=a(this.defrag,this)}return c.prototype.defrag=function(a){var c,d,e,f,g,h,i,j,k,l,m,n,o,p;n=b.assert_matrix_dimensions(a),l=n[0],m=n[1],o=this._get_group_deltas(a,l),d=o[0],k=o[1];if(d.length===0)return a;p=[];for(;;){if((c=_.max(d))===0)return a;e=d.lastIndexOf(c),j=k[e],i=a[j];if(c>1||i[0]>=0)f=i.indexOf(-(e+1)),a[j]=_.rest(i,f).concat(_.first(i,f));p.push(function(){var a,b;b=[];for(h=0,a=k.length;h<a;h++)g=k[h],b.push(Math.abs(j-g)<=1?d[h]=0:void 0);return b}())}return p},c.prototype._get_group_deltas=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x;v=[function(){var b,d,e;e=[];for(b=0,d=a.length;b<d;b++)q=a[b],e.push(function(){var a,b,d;d=[];for(a=0,b=q.length;a<b;a++)c=q[a],d.push(Math.abs(c));return d}());return e}(),function(){var b,d,e,f;e=a[0],f=[];for(b=0,d=e.length;b<d;b++)c=e[b],f.push(0);return f}()],p=v[0],g=v[1],w=[[],[],[g].concat(p.concat([g]))],f=w[0],r=w[1],p=w[2];for(k=0,s=a.length;k<s;k++){q=a[k],l=k+1;for(o=0,t=q.length;o<t;o++){i=q[o];if(i<0&&o>0){x=[0,Math.abs(i)-1,q.indexOf(i)],e=x[0],h=x[1],j=x[2];for(m=0,u=q.length;m<u;m++)c=q[m],p[l-1][m]-p[l][m]===0&&e--,p[l+1][m]-p[l][m]===0&&e--,n=(j+m)%(b+1),p[l-1][m]-p[l][n]===0&&e++,p[l+1][m]-p[l][n]===0&&e++;f[h]=e+1,r[h]=k}}}return[function(){var a,b,c;c=[];for(a=0,b=f.length;a<b;a++)d=f[a],c.push(d!=null?d:0);return c}(),function(){var a,b,c;c=[];for(a=0,b=r.length;a<b;a++)k=r[a],c.push(k!=null?k:0);return c}()]},c}(),new c})}).call(this);