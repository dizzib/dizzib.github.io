(function(){var a=function(a,b){return function(){return a.apply(b,arguments)}};define(["sys/messaging/protocol","lib/sys/net","lib/guardian"],function(b,c){var d;return d=function(){function d(){this.update_param=a(this.update_param,this),this.unload=a(this.unload,this),this.stop=a(this.stop,this),this.start=a(this.start,this),this.process=a(this.process,this),this.load=a(this.load,this),this.init=a(this.init,this),this.bang=a(this.bang,this),this.abort=a(this.abort,this)}return d.prototype._states={IDLE:0,STARTED:1,LOADED:2},d.prototype._state=0,d.prototype.on_abort=function(){},d.prototype.on_init=function(){},d.prototype.on_load=function(){},d.prototype.on_start=function(){},d.prototype.on_stop=function(){},d.prototype.on_unload=function(){},d.prototype.abort=function(a){return this._state===this._states.LOADED?this.unload(a):(this.on_abort(a),this._state=this._states.IDLE)},d.prototype.bang=function(){return c.trigger([b.TRIGGERS.BANG])},d.prototype.init=function(){return assert(a(function(){return this._state===this._states.STARTED},this)),c.trigger([b.TRIGGERS.PROTOCOL_PROBE])},d.prototype.load=function(){return assert(a(function(){return this._state===this._states.STARTED},this)),this.bang(),this.on_load(),this._state=this._states.LOADED},d.prototype.process=function(a){var c,d;return d=a[0],c=a[1],assert(function(){return d in b.COMMANDS}),b.COMMANDS[d](c)},d.prototype.start=function(b){return assert(a(function(){return this._state===this._states.IDLE||this._state===this._states.STARTED},this)),this.on_start(b),this._state=this._states.STARTED},d.prototype.stop=function(){return this.on_stop()},d.prototype.unload=function(b){return assert(a(function(){return this._state===this._states.LOADED},this)),this.on_unload(b),this._state=this._states.IDLE},d.prototype.update_param=function(a){return c.trigger([b.TRIGGERS.PARAM_UPDATE,a])},d}(),new d})}).call(this);