(function(){var a=function(a,b){return function(){return a.apply(b,arguments)}};define(["jquery","underscore","lib/guardian","css!./box","css!./cells"],function(b,c){var d;return new(d=function(){function c(){this._create_box=a(this._create_box,this),this.auto_expand=a(this.auto_expand,this),this.toggle=a(this.toggle,this),this.get_volume=a(this.get_volume,this),this.create=a(this.create,this),this.init=a(this.init,this)}return c.prototype._AUTO_EXPAND_TAME_BOX_THRESHOLD=4,c.prototype.init=function(a){return a.$desk.on("safe-tap",".box.tame > .head",{toggle:this.toggle},function(a){return a.data.toggle(b(this)),a.handled=!0})},c.prototype.on_group_create=function(){},c.prototype.on_toggle=function(){},c.prototype.create=function(a){var c,d,e,f,g,h,i,j,k,l;c=a.$box=this._create_box(a),a.type==="wild"&&(d=b(b.zen(".cells")).appendTo(c)),j=a.groups,l=[];for(h=0,i=j.length;h<i;h++)k=j[h],g=k[0],e=k[1],f=k[2],a.type==="tame"&&(d=b(b.zen(".cells")).appendTo(c)),l.push(this.on_group_create({uid:g,name:e,tint:f,$cells:d}));return l},c.prototype.get_volume=function(a){return a.find(".box:not(.hidden) .cell:not(.hidden)").length},c.prototype.toggle=function(a){var c;return c=a.parents(".box").toggleClass("hidden"),b(".group:not(:hidden), .head:not(:hidden)",c).indicate(),this.on_toggle({$target:c})},c.prototype.auto_expand=function(a){var b;if((b=a.find(".box.tame")).length<=this._AUTO_EXPAND_TAME_BOX_THRESHOLD)return b.removeClass("hidden")},c.prototype._create_box=function(a){var c;return c=b(b.zen(".box."+a.type)),a.type==="tame"&&c.addClass("hidden").append(b.zen(".head.cell>h3{"+a.name.fracture()+"}")),c},c}())})}).call(this);