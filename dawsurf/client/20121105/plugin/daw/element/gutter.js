(function(){var a=function(a,b){return function(){return a.apply(b,arguments)}};define(["jquery","plugin/constants","plugin/element/tracks","plugin/lib/ui/scrollport","plugin/model/setting/is-super-scroll","lib/guardian","css!./gutter"],function(b,c,d,e,f){var g;return new(g=function(){function c(){this._remove_track=a(this._remove_track,this),this._move_track=a(this._move_track,this),this._expand_track=a(this._expand_track,this),this._collapse_track=a(this._collapse_track,this),this.remove=a(this.remove,this),this.move=a(this.move,this),this.insert=a(this.insert,this),this.collapse=a(this.collapse,this),this.add=a(this.add,this),this.init=a(this.init,this)}return c.prototype.init=function(a){return a.$desk.on("safe-tap",".gutter-i > .track > .head",{expand:this._expand_track},function(a){var c;return c=b(this).parent(),c.hasClass("disabled")||a.data.expand({$track:c}),!1})},c.prototype.on_add_first=function(){},c.prototype.on_expand=function(){},c.prototype.add=function(a){this._collapse_track(a);if(b(".gutter-o").length===1)return this.on_add_first()},c.prototype.collapse=function(a){return this._collapse_track(a)},c.prototype.insert=function(a){return this._collapse_track(a)},c.prototype.move=function(a){return this._move_track(a)},c.prototype.remove=function(a){return this._remove_track(a)},c.prototype.set_height=function(a,b){return a.find("> .gutter-i").andSelf().height(b)},c.prototype._create_gutter=function(){var a;return a=b(b.zen(".gutter-o>.gutter-i")),f.value()&&e.init(a.find(".gutter-i"),{x:!1}),a},c.prototype._collapse_track=function(a){var b,c,e,f;return this._is_in_gutter(a.$track)||(f=[a.$track.prevAll(".gutter-o").first(),a.$track.nextAll(".gutter-o").first()],c=f[0],b=f[1],c.length===0&&d.prepend(c=this._create_gutter()),e=a.$track.prev().hasClass("gutter-o")?c:b,e.length===0&&(e=b=this._create_gutter().insertAfter(a.$track)),e.find(".gutter-i").append(a.$track),this._merge_adjacent_gutters()),a.$track.removeAttr("style")},c.prototype._expand_track=function(a){var b,c,d,e=this;assert(function(){return e._is_in_gutter(a.$track)}),b=a.$track.parent().parent();if(a.$track.is(".track:first"))a.$track.insertBefore(b),this._is_in_gutter(a.$track.prev())||this._create_gutter().insertBefore(a.$track);else{d=a.$track.nextAll(".track"),a.$track.insertAfter(b);if(d.length>0||!this._is_in_gutter(a.$track.next()))(c=a.$track.next(".gutter-o")).length===0&&(c=this._create_gutter().insertAfter(a.$track)),c.find(".gutter-i").prepend(d)}return this.on_expand(a),this._trim_side_gutters()},c.prototype._move_track=function(a){var b,c,d,e;return e=a.target_placement==="Before",this._is_in_gutter(a.$track)?(this._is_in_gutter(a.$target)?e?a.$track.insertBefore(a.$target):a.$track.insertAfter(a.$target):((c=e?a.$target.prev(".gutter-o"):a.$target.next(".gutter-o")).length===0&&(assert(function(){return!e}),c=this._create_gutter().insertAfter(a.$target)),d=c.find(".gutter-i"),e?a.$track.appendTo(d):a.$track.prependTo(d)),this._trim_side_gutters()):(a.$track.detach(),this._merge_adjacent_gutters(),this._is_in_gutter(a.$target)?(e?a.$target.before(a.$track):a.$target.after(a.$track),this._expand_track(a)):(b=this._create_gutter(),e?a.$target.before(a.$track,b):a.$target.after(b,a.$track)))},c.prototype._remove_track=function(a){return this._merge_adjacent_gutters(),this._trim_side_gutters()},c.prototype._trim_side_gutters=function(){var a;(a=d.get_first()).hasClass("gutter-o")&&a.find(".gutter-i").children().length===0&&a.remove();if((a=d.get_last()).hasClass("gutter-o")&&a.find(".gutter-i").children().length===0)return a.remove()},c.prototype._merge_adjacent_gutters=function(){var a,c,d,e,f,g;f=b(".gutter-o + .gutter-o"),g=[];for(d=0,e=f.length;d<e;d++)a=f[d],c=b(a).prev(),b(a).find(".gutter-i").prepend(c.find(".gutter-i").children()),g.push(c.remove());return g},c.prototype._is_in_gutter=function(a){return a.parent().hasClass("gutter-i")},c}())})}).call(this);