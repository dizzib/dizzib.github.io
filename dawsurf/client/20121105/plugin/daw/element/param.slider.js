(function(){var a=function(a,b){return function(){return a.apply(b,arguments)}};define(["jquery","underscore","plugin/lib/ui/viewport","input/touch","lib/guardian","css!./param.slider.css"],function(b,c,d,e){var f;return new(f=function(){function f(){this._enable_rail=a(this._enable_rail,this),this._get_initial_pos=a(this._get_initial_pos,this),this._on_touchmove=a(this._on_touchmove,this),this._initialise_pos=a(this._initialise_pos,this),this.stop_input=a(this.stop_input,this),this.start_input=a(this.start_input,this)}return f.prototype._THROTTLE_FREQ_HZ=20,f.prototype.on_input_start=function(){},f.prototype.on_input_stop=function(){},f.prototype.on_value_change=function(){},f.prototype.start_input=function(a,c){var d,f=this;return this._p&&this.stop_input(),this._p=a,this._$rail=a.$sensor,this._$puck=b(b.zen(".puck")).appendTo(this._$rail),this.on_input_start(a),this._$rail.addClass("rail").appendTo(this._div_root),this._p.$param.attr("value_user",d=this._p.$param.attr("value")),this._initialise_pos(d,c.pageX),c.is_tap?this._$rail.on(e.event_name_start,function(b){return f._on_touchmove(b),f._enable_rail(a)}):this._enable_rail(a)},f.prototype.stop_input=function(){if(!this._p)return;return this._$rail.off(""+e.event_name_start+" "+e.event_name_move+" "+e.event_name_end),this._$rail.removeAttr("style").removeClass("rail"),this._$puck.remove(),this.on_input_stop(this._p),delete this._$rail,delete this._$puck,delete this._p},f.prototype._initialise_pos=function(a,b){var c,e,f;return this._rail_width=this._$rail.width(),this._puck_width_semi=this._$puck.width()/2,f=this._get_initial_pos(a,b),c=f[0],this._rail_left=f[1],e=this._$rail.height()+2*parseInt(this._$rail.css("border-top-width"),10),this._$puck.css("left",c),this._$rail.css("left",this._rail_left).css("top",d.get_css_bottom(this._p.$param)-e)},f.prototype._on_touchmove=function(a){var b,c,d,f;if(this._$rail===void 0)return;a.preventDefault(),c=e.get_raw_event(a),b=Math.min(this._rail_width,Math.max(0,c.pageX-this._rail_left)),this._$puck.css("left",b-this._puck_width_semi),f=parseInt(this._p.$param.attr("value_user")),d=Math.floor(100*b/this._rail_width);if(d!==f)return this._p.$param.attr("value_user",d),this.on_value_change({uid:this._p.uid,value:d})},f.prototype._get_initial_pos=function(a,b){var c,e,f;return e=this._rail_width*a/100,c=e-this._puck_width_semi,b!=null?f=b-e:f=d.get_css_left(this._p.$param)-e,[c,f]},f.prototype._enable_rail=function(a){var b=this;return this._$rail.on(e.event_name_move,c.throttle(function(a){return b._on_touchmove(a)},1e3/this._THROTTLE_FREQ_HZ,!1,function(a){return a.preventDefault()})),this._$rail.on(e.event_name_end,function(a){return b.stop_input()}),this._$puck.on(e.event_name_end,function(a){return b.stop_input()})},f}())})}).call(this);