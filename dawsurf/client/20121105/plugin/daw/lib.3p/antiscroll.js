(function(a){function b(b,c){this.el=a(b),this.options=c||{},this.x=!1!==this.options.x,this.y=!1!==this.options.y,this.padding=undefined==this.options.padding?2:this.options.padding,this.inner=this.el.find(".antiscroll-inner"),this.refresh()}function c(b){this.pane=b,this.pane.el.append(this.el),this.innerEl=this.pane.inner.get(0),this.dragging=!1,this.enter=!1,this.shown=!1,this.pane.el.mouseenter(a.proxy(this,"mouseenter")),this.pane.el.mouseleave(a.proxy(this,"mouseleave")),this.el.mousedown(a.proxy(this,"mousedown")),this.pane.inner.scroll(a.proxy(this,"scroll")),this.pane.inner.bind("mousewheel",a.proxy(this,"mousewheel"));var c=this.pane.options.initialDisplay;c!==!1&&(this.show(),this.hiding=setTimeout(a.proxy(this,"hide"),parseInt(c,10)||3e3))}function d(a,b){function c(){}c.prototype=b.prototype,a.prototype=new c}function f(){if(e===undefined){var b=a('<div style="width:50px;height:50px;overflow:hidden;position:absolute;top:-200px;left:-200px;"><div style="height:100px;"></div>');a("body").append(b);var c=a("div",b).innerWidth();b.css("overflow-y","scroll");var d=a("div",b).innerWidth();a(b).remove(),e=c-d}return e}a.fn.antiscroll=function(b){return this.each(function(){a(this).data("antiscroll")&&a(this).data("antiscroll").destroy(),a(this).data("antiscroll",new a.Antiscroll(this,b))})},a.Antiscroll=b,b.prototype.refresh=function(){var b=this.el.width(),d=this.el.height(),e,f;this.inner.css({"min-width":b+a.scrollbarWidth()+"px","min-height":d+a.scrollbarWidth()+"px"}),e=this.inner.get(0).scrollWidth>this.inner.get(0).clientWidth,f=this.inner.get(0).scrollHeight>this.inner.get(0).clientHeight,!this.horizontal&&e&&this.x?this.horizontal=new c.Horizontal(this):this.horizontal&&!e&&(this.horizontal.destroy(),this.horizontal=null),!this.vertical&&f&&this.y?this.vertical=new c.Vertical(this):this.vertical&&!f&&(this.vertical.destroy(),this.vertical=null)},b.prototype.destroy=function(){return this.horizontal&&(this.horizontal.destroy(),this.horizontal=null),this.vertical&&(this.vertical.destroy(),this.vertical=null),this},b.prototype.rebuild=function(){return this.destroy(),this.inner.attr("style",""),b.call(this,this.el,this.options),this},c.prototype.destroy=function(){return this.el.remove(),this},c.prototype.mouseenter=function(){this.enter=!0,this.show()},c.prototype.mouseleave=function(){this.enter=!1,this.dragging||this.hide()},c.prototype.scroll=function(){this.shown||(this.show(),!this.enter&&!this.dragging&&(this.hiding=setTimeout(a.proxy(this,"hide"),1500))),this.update()},c.prototype.mousedown=function(b){b.preventDefault(),this.dragging=!0,this.startPageY=b.pageY-parseInt(this.el.css("top"),10),this.startPageX=b.pageX-parseInt(this.el.css("left"),10),document.onselectstart=function(){return!1};var c=this.pane,d=a.proxy(this,"mousemove"),e=this;a(document).mousemove(d).mouseup(function(){e.dragging=!1,document.onselectstart=null,a(document).unbind("mousemove",d),e.enter||e.hide()})},c.prototype.show=function(a){this.shown||(this.update(),this.el.addClass("antiscroll-scrollbar-shown"),this.hiding&&(clearTimeout(this.hiding),this.hiding=null),this.shown=!0)},c.prototype.hide=function(){var a=this.pane.options.autoHide;a!==!1&&this.shown&&(this.el.removeClass("antiscroll-scrollbar-shown"),this.shown=!1)},c.Horizontal=function(b){this.el=a('<div class="antiscroll-scrollbar antiscroll-scrollbar-horizontal">'),c.call(this,b)},d(c.Horizontal,c),c.Horizontal.prototype.update=function(){var a=this.pane.el.width(),b=a-this.pane.padding*2,c=this.pane.inner.get(0);this.el.css("width",b*a/c.scrollWidth).css("left",b*c.scrollLeft/c.scrollWidth)},c.Horizontal.prototype.mousemove=function(a){var b=this.pane.el.width()-this.pane.padding*2,c=a.pageX-this.startPageX,d=this.el.width(),e=this.pane.inner.get(0),f=Math.min(Math.max(c,0),b-d);e.scrollLeft=(e.scrollWidth-this.pane.el.width())*f/(b-d)},c.Horizontal.prototype.mousewheel=function(a,b,c,d){if(c<0&&0==this.pane.inner.get(0).scrollLeft||c>0&&this.innerEl.scrollLeft+Math.ceil(this.pane.el.width())==this.innerEl.scrollWidth)return a.preventDefault(),!1},c.Vertical=function(b){this.el=a('<div class="antiscroll-scrollbar antiscroll-scrollbar-vertical">'),c.call(this,b)},d(c.Vertical,c),c.Vertical.prototype.update=function(){var a=this.pane.el.height(),b=a-this.pane.padding*2,c=this.innerEl;this.el.css("height",b*a/c.scrollHeight).css("top",b*c.scrollTop/c.scrollHeight)},c.Vertical.prototype.mousemove=function(a){var b=this.pane.el.height(),c=b-this.pane.padding*2,d=a.pageY-this.startPageY,e=this.el.height(),f=this.innerEl,g=Math.min(Math.max(d,0),c-e);f.scrollTop=(f.scrollHeight-b)*g/(c-e)},c.Vertical.prototype.mousewheel=function(a,b,c,d){if(d>0&&0==this.innerEl.scrollTop||d<0&&this.innerEl.scrollTop+Math.ceil(this.pane.el.height())==this.innerEl.scrollHeight)return a.preventDefault(),!1};var e})(jQuery);