(function(){var a=function(a,b){return function(){return a.apply(b,arguments)}};define(["underscore","lib/guardian"],function(b){var c;return c=function(){function c(){this._defrag_last_group=a(this._defrag_last_group,this),this._append_cells_to_lane=a(this._append_cells_to_lane,this),this._populate_lanes=a(this._populate_lanes,this),this.build=a(this.build,this)}return c.prototype.build=function(a,b,c){var d,e,f;assert(function(){return b.length===c.length}),this._populate_lanes(a,b,c);for(e=0,f=a.length;e<f;e++)d=a[e],this._quantize_lane(d);return a},c.prototype._populate_lanes=function(a,c,d){var e,f,g,h;for(e=0,h=d.length;e<h;e++)g=d[e],f=b.min(a,function(a){return 100*a.matrix.length+b.last(a.matrix).length}),this._append_cells_to_lane(f,c[e],g);return a},c.prototype._append_cells_to_lane=function(a,c,d){var e,f,g,h,i,j,k;(f=b.last(a.matrix)).length===a.x_size&&a.matrix.push(f=[]),j=[f.length,(f.length+d-1)%a.x_size],h=j[0],g=j[1],i=Math.floor((h+d)/a.x_size),i>0&&h>g&&(this._defrag_last_group(a,c-1),a.matrix.push(f=[])),k=[];for(e=1;1<=d?e<=d:e>=d;1<=d?e++:e--)f.length===a.x_size&&a.matrix.push(f=[]),k.push(f.push(e===1?-c:c));return k},c.prototype._defrag_last_group=function(a,c){var d,e,f,g,h,i,j,k,l,m,n;if(c===0)return;l=[(d=g=b.last(a.matrix)).length,a.matrix.length-1],h=l[0],k=l[1];while(k>0&&(j=g.indexOf(-c))<0)g=a.matrix[--k];return j!=null&&j>=h&&(f=a.x_size-j,i=h+f-1,[].splice.apply(g,[j,a.x_size-1-j+1].concat(m=function(){var a;a=[];for(e=1;1<=f?e<=f:e>=f;1<=f?e++:e--)a.push(0);return a}())),m,[].splice.apply(d,[h,i-h+1].concat(n=function(){var a;a=[];for(e=1;1<=f?e<=f:e>=f;1<=f?e++:e--)a.push(c);return a}())),n,d[0]=-c),this._quantize_lane(a)},c.prototype._quantize_lane=function(a){var c,d;c=b.last(a.matrix),d=[];while(c.length<a.x_size)d.push(c.push(0));return d},c}(),new c})}).call(this);