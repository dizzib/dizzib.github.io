(function(){var a=function(a,b){return function(){return a.apply(b,arguments)}};define(["jquery","underscore","lib/platform/window","plugin/constants","plugin/element/gutters","plugin/element/track","plugin/element/tracks","lib/guardian"],function(b,c,d,e,f,g,h){var i;return i=function(){function b(){this._refresh_display_aspect=a(this._refresh_display_aspect,this),this.resize=a(this.resize,this)}return b.prototype._CELL_SIZE_CORRECTION=2,b.prototype._DISPLAY_ASPECT_CORRECTION=.8,b.prototype._TRACK_WIDTH_CORRECTION=8,b.prototype._x_sizes=[],b.prototype.on_resize=function(){},b.prototype.on_track_resize=function(){},b.prototype.resize=function(a){var b,c,i,j,k,l,m,n,o,p,q,r,s,t,u,v=this;a==null&&(a={window:d}),this._refresh_display_aspect(a),s=h.get_volumes(),l=s[0],i=s[1],p=Math.sqrt(i)*assert(function(){return v._display_aspect});for(q=0,r=l.length;q<r;q++)t=l[q],b=t[0],k=t[1],m=Math.max(2,Math.floor(p*k/Math.max(1,i))),g.set_width(b,m*e.CELL_SIZE+this._CELL_SIZE_CORRECTION),u=[this._x_sizes[j=b.attr("id")],m],o=u[0],n=u[1],this._x_sizes[j]=n,c=b.is(a.$track)||g.is_parent(b,a.$target),(n!==o||c)&&this.on_track_resize({$track:b,x_size:n});return a.width_tracks=h.get_width()+f.get_width()+this._TRACK_WIDTH_CORRECTION,h.set_width_root(a.width_tracks),this.on_resize(a)},b.prototype._refresh_display_aspect=function(a){if(a.window)return this._display_aspect=this._DISPLAY_ASPECT_CORRECTION*a.window.width/a.window.height},b}(),new i})}).call(this);