(function(){var a=function(a,b){return function(){return a.apply(b,arguments)}};define(["sys/messaging/protocol","lib/sys/net","lib/guardian"],function(b,c){var d;return d=function(){function d(){this.update_param=a(this.update_param,this),this.unload=a(this.unload,this),this.stop=a(this.stop,this),this.start=a(this.start,this),this.process=a(this.process,this),this.load=a(this.load,this),this.init=a(this.init,this),this.error=a(this.error,this),this.bang=a(this.bang,this),this.abort=a(this.abort,this)}return d.prototype._states={IDLE:0,STARTED:1,LOADED:2},d.prototype._state=0,d.prototype.on_error=function(){},d.prototype.on_init=function(){},d.prototype.on_load=function(){},d.prototype.on_start=function(){},d.prototype.on_stop=function(){},d.prototype.on_unload=function(){},d.prototype.abort=function(a){return this.stop(),this.on_error(a),this._state=this._states.IDLE},d.prototype.bang=function(){return c.trigger([b.TRIGGERS.BANG])},d.prototype.error=function(a){return this.on_error(a)},d.prototype.init=function(){var a=this;return assert(function(){return a._state===a._states.STARTED}),c.trigger([b.TRIGGERS.PROTOCOL_PROBE])},d.prototype.load=function(){var a=this;return assert(function(){return a._state===a._states.STARTED}),this.bang(),this.on_load(),this._state=this._states.LOADED},d.prototype.process=function(a){var c,d;return d=a[0],c=a[1],assert(function(){return d in b.COMMANDS}),b.COMMANDS[d](c)},d.prototype.start=function(a){var b=this;return assert(function(){return b._state===b._states.IDLE||b._state===b._states.STARTED}),this.on_start(a),this._state=this._states.STARTED},d.prototype.stop=function(){return this.on_stop()},d.prototype.unload=function(a){if(this._state!==this._states.LOADED)return;return this.on_unload(a),this._state=this._states.IDLE},d.prototype.update_param=function(a){return c.trigger([b.TRIGGERS.PARAM_UPDATE,a])},d}(),new d})}).call(this);