(function(){var a=function(a,b){return function(){return a.apply(b,arguments)}};define(["jquery","knockout","underscore","model/servers","lib/platform/features","lib/regex.pattern","lib/guardian","css!view/servers"],function(b,c,d,e,f,g){var h;return h=function(){function h(){this._start_edit=a(this._start_edit,this),this._server_connect=a(this._server_connect,this),this._server_edit_start=a(this._server_edit_start,this),this._server_edit_save=a(this._server_edit_save,this),this._server_edit_cancel=a(this._server_edit_cancel,this),this._server_delete=a(this._server_delete,this),this._server_add=a(this._server_add,this),this._auto_connect__on_click=a(this._auto_connect__on_click,this),this._init_validator=a(this._init_validator,this),this.init=a(this.init,this)}return h.prototype.init=function(){var d;return d=b("#servers"),assert(function(){return d.length}),d.load("view/servers.html",a(function(){return this._$editor=b("#server-editor"),c.applyBindings(this,d[0]),this._init_validator()},this))},h.prototype.on_activate=function(){},h.prototype.on_alert=function(){},h.prototype._is_connectible=f.websockets,h.prototype._editor_server=c.observable(),h.prototype._editor_message=c.observable(),h.prototype._init_validator=function(){var c;return c=new RegExp(g.VALID_HOSTNAME_OR_IPADDRESS_REGEX),b.validator.addMethod("server",function(a){return c.test(a)},"Please enter a valid server name or IP address"),this._validator=assert(a(function(){return this._$editor},this)).validate({rules:{id:{required:!0,maxlength:30},server:{required:!0,maxlength:30,server:!0},port:{required:!0,digits:!0,range:[0,65535]}}})},h.prototype._auto_connect__on_click=function(a,b){return this.auto_connect_id(b.target.checked?a.id():null),!0},h.prototype._server_add=function(){return this._start_edit(e.create(),!0)},h.prototype._server_delete=function(){var c,d;return d=assert(a(function(){return this._editor_server()},this)),c=b("<div/>").html("Are you sure ?").dialog({buttons:{Yes:a(function(){return e.remove(d),e.save(),this.on_alert({message:"Deleted "+d.id()}),this._editor_server(null),c.dialog("close")},this),No:a(function(){return c.dialog("close")},this)},closeOnEscape:!0,dialogClass:"dialog-confirm",modal:!0,resizable:!1,title:"Delete "+d.id(),width:300})},h.prototype._server_edit_cancel=function(){return e.load(),this._editor_server(null)},h.prototype._server_edit_save=function(){var b;if(!this._$editor.valid())return;return b=assert(a(function(){return this._editor_server()},this)),b.is_new&&(delete b.is_new,e.add(b)),e.save(),this._editor_server(null)},h.prototype._server_edit_start=function(a){return this._start_edit(a,!1)},h.prototype._server_connect=function(a){return this.on_activate(a)},h.prototype._start_edit=function(b,c){return assert(a(function(){return this._$editor},this)).dialog("option","title",""+(c?"Add":"Edit")+" Server Configuration"),assert(a(function(){return this._validator},this)).resetForm(),this._editor_server(d.extend(b,{is_new:c}))},h}(),new h})}).call(this);